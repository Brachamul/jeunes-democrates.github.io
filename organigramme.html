<!DOCTYPE html>
<html lang="fr">

<head>

	<meta charset="utf-8">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700&subset=latin-ext" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Bad+Script" rel="stylesheet"> 

	<!-- vue -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.min.js"></script>

	<!-- vue-resource -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.0.3/vue-resource.min.js"></script>

	<!-- vuex -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/2.0.0/vuex.min.js"></script>

</head>

<div id="app"></div>

<div class="organigramme__pole">

	<p><strong>Le Bureau National est le "gouvernement" des Jeunes Démocrates.</strong> Il est élu pour une durée de deux ans, et est constitué de 21 membres, dont un(e) président(e).</p>
	<p>La dernière élection a eu lieu en mars 2016. La dernière modification a eu lieu en septembre 2016.</p>
	
	<p>La composition peut évoluer :</p>
	<ul>
		<li>En cas de cooptation d'un(e) membre, dans la limite de deux nouveaux membres par an</li>
		<li>En cas de démission d'un(e) membre, par exemple dans le cadre de l'application de notre <a href="http://jeunes-democrates.org/nos-textes/la-charte-ethique/">charte éthique</a> qui prévient le cumul d'un mandat de président de fédération avec celui de membre du bureau</li>
	</ul>

</div>

<style>

/* Organigramme du bureau */
.organigramme__pole { padding: 1.25em; font-family: 'Roboto Slab', 'Century Gothic', sans-serif; font-size: 1.2em; line-height: 1.5; }
.organigramme__pole__name { font-size: 1.4em; color: #004067; font-family: "Bad Script", sans-serif; }
.organigramme__pole__email { position: relative; bottom: .5em; }
.organigramme__pole__email::before { content: '\f1d8'; font-family: 'FontAwesome'; margin-right: .5em; }
.organigramme__photo { width: 5.5em; height: 5.5em; margin-right: 1em; background-color: #ccc; float: left; border-radius: 5em; }
.organigramme__name { font-size: 1.4em; text-transform: uppercase; color: #004067; }
.organigramme__titre { margin-bottom: .25em; color: #666; }
.small .organigramme__photo { width: 4.5em; height: 4.5em; margin-right: 1.5em; margin-left: .5em; }
.small .organigramme__name { font-size: 1.1em; }
.small .organigramme__titre { font-size: .8em; }
.organigramme__membre { margin: 1em 0; padding-left: 1em; border-left: .25em solid #ff6000; }
.organigramme__liens { display: block; min-width: 1em; }
.organigramme__liens a::before { font-family: 'FontAwesome'; margin-right: .5em; }
.organigramme__email::before { content: '\f0e0'; }
.organigramme__twitter::before { content: '\f099'; }
.organigramme__bouton { display: inline-block; font-size: .55em; background-color: #009FFF; border-radius: 4px; padding: .3em .6em; color: white; }

</style>

<script>

// Store
const store = new Vuex.Store({
	state: {
		poles: [],
	},
	mutations: {
		updatePoles(state, payload) {
			let poles = payload['poles']
			let members = payload['members']
			state.poles = []
			for (i in poles) {
				let pole = poles[i].fields
				for (i in pole.Membres) {
					pole.Membres[i] = members.filter(obj => obj.id == pole.Membres[i] )[0].fields
				}
				state.poles.push(pole)
			}
		}
	}
})

// var result = jsObjects.filter(obj => obj.b == 6)[0]


// Components
const Organogram = {
	template: `
		<div id="organigramme__poles">
			<div class="organigramme__pole" v-for="pole in poles">

				<div class="organigramme__pole__name">{{ pole.Name }}</div>
				<div class="organigramme__pole__email organigramme__bouton" v-bind:data-email="pole.Email">Contacter</div>
				
				<div class="organigramme__membre" v-for="Membre in pole.Membres" v-bind:class="{ small: !Membre.UM }">
					<div class="organigramme__photo" v-bind:data-img-url="Membre.photo_url"></div>
					<div class="organigramme__name">{{ Membre.Prénom }} <strong>{{ Membre.Nom }}</strong></div>
					<div class="organigramme__titre">{{ Membre.Rôle }}</div>
					<div class="organigramme__liens"><a class="organigramme__twitter organigramme__bouton">@{{ Membre.Twitter }}</a></div>
				</div>

			</div>
		</div>
	`,
	computed: {
		poles () {
			return this.$store.state.poles
		}
	}
}


Vue.http.get('https://api.airtable.com/v0/appHznRjE909j9VlP/Pôles?api_key=keyQ9LAVuNmhIIhjN').then((response) => {
	let poles = response.body.records
	Vue.http.get('https://api.airtable.com/v0/appHznRjE909j9VlP/Membres?api_key=keyQ9LAVuNmhIIhjN').then((response) => {
		let members = response.body.records
		store.commit('updatePoles', {'poles': poles, 'members': members})
	})
})


// App
const app = new Vue({
	el: '#app',
	store,
	components: { Organogram },
	template: `
		<div class="app">
			<organogram></organogram>
		</div>
	`
})

</script>